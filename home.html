<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./asset/main.css" />
    <title>Trang Công Đức</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/treeflex/dist/css/treeflex.css"
    />
    <script src="./asset/js/authGuard.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="navigation">
        <ul>
          <li>
            <a href="#">
              <!-- <img src="./asset/img/logo.png" alt="" class="logo_main"> -->
            </a>
          </li>
          <li>
            <a href="index.html">
              <span class="icon"
                ><i class="fa-solid fa-house sidebar_left--icon"></i
              ></span>
              <span class="title">Trang chủ</span>
            </a>
          </li>
          <li>
            <a href="phahe.html">
              <span class="icon"><i class="fa-solid fa-users"></i></span>
              <span class="title">Quản lí phả hệ</span>
            </a>
          </li>
          <li>
            <a href="#">
              <span class="icon"
                ><i class="fa-solid fa-book-bookmark"></i
              ></span>
              <span class="title">Quản lí phả ký</span>
            </a>
          </li>
          <li>
            <a href="phado.html">
              <span class="icon"
                ><i class="fa-solid fa-network-wired sidebar_left--icon"></i
              ></span>
              <span class="title">Quản lí phả đồ</span>
            </a>
          </li>
          <li>
            <a href="ngoaipha.html">
              <span class="icon"
                ><i class="fa-solid fa-book-open-reader"></i
              ></span>
              <span class="title">Ngoại phả</span>
            </a>
          </li>
          <li>
            <a href="phukhao.html">
              <span class="icon"
                ><i class="fa-solid fa-house-chimney"></i
              ></span>
              <span class="title">Phụ khảo</span>
            </a>
          </li>
          <li>
            <a href="hinhanh.html">
              <span class="icon"><i class="fa-solid fa-images"></i></span>
              <span class="title">Hình ảnh</span>
            </a>
          </li>
          <li>
            <a href="congduc.html">
              <span class="icon"><i class="fa-solid fa-toolbox"></i></span>
              <span class="title">Công đức</span>
            </a>
          </li>
          <!-- Thay thẻ a bằng button cho nút đăng xuất -->
          <li>
            <button
              onclick="handleLogout()"
              class="logout-btn"
              style="
                background: none;
                border: none;
                width: 100%;
                text-align: left;
                padding: 10px;
                cursor: pointer;
              "
            >
              <span class="icon"
                ><i class="fa-solid fa-right-to-bracket"></i
              ></span>
              <span class="title">Đăng xuất tài khoản</span>
            </button>
          </li>
        </ul>
      </div>
    </div>
    <!-- main -->
    <div class="main">
      <div class="topbar">
        <div class="toggle">
          <i class="fa-solid fa-bars"></i>
        </div>
        <div class="search">
          <label for="">
            <input type="text" placeholder="Tìm kiếm" />
            <i class="fa-solid fa-magnifying-glass"></i>
          </label>
        </div>
        <!-- --userImg-- -->
        <div class="user"></div>
        <!-- CODE HERE -->
      </div>
      <div class="main_content">
        <div class="content_pk">
          <div class="title-box">HOME</div>
        </div>
      </div>
    </div>
    <!-- Thêm script auth.js trước các script khác -->
    <script src="./asset/js/auth.js"></script>
    <script src="./asset/js/main.js"></script>
    <script type="module" src="./asset/js/login.js"></script>
    <script type="module">
      import { renderUserAvatar } from "./asset/js/userInfo.js";
      renderUserAvatar();
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Kiểm tra token ngay khi trang load
        if (!checkAuth()) {
          return; // Dừng thực thi nếu không có token
        }

        // Các chức năng khác của trang home...
      });

      function handleLogout() {
        localStorage.removeItem("userToken");
        localStorage.removeItem("userId");
        localStorage.removeItem("userRole");
        localStorage.removeItem("userData");
        window.location.href = "index.html";
      }

      // Thêm hàm chuyển đến trang profile
      function goToProfile() {
        if (checkAuth()) {
          // Thực hiện chuyển đến trang profile
          window.location.href = "profile.html";
        }
      }
    </script>
  </body>
</html>
